@using CarRentalBLL.ViewModels.Car
@model PagedResult<CarRentalBLL.ViewModels.Car.CarCardVM>
@{
    ViewData["Title"] = "Index";
    // SelectList options = new SelectList(ViewBag.Categories, "Id", "Name");
    // SelectList options2 = new SelectList(ViewBag.Brands);
    SelectList options = new SelectList(
       ViewBag.Categories,
       "Id",
       "Name",
       ViewData["SelectedCategory"]   // selected
   );

    SelectList options2 = new SelectList(
        ViewBag.BrandsList,
        ViewData["SelectedBrand"]       // selected
    );

}

@section Styles {
    <link rel="stylesheet" href="~/css/Cars-Page.css" />
}

<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <h1 class="page-title">Our Vehicles</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a asp-action="Index" asp-controller="Test" style="color: rgba(255,255,255,0.8); text-decoration: none;">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Vehicles</li>
            </ol>
        </nav>

    </div>
</section>

<!-- Filter Section -->
<section class="container mt-4">
    <div class="filter-section">

        <h4 class="filter-title">Filter Vehicles</h4>
        <form asp-action="Index" method="get" id="filterForm">
        <div class="row justify-content-center g-3">
                <div class="col-md-4">
                    <label class="form-label">Search by Name :</label>
                    <input type="text" placeholder="Search by Name" class="form-control" name="searchTerm" value="@ViewData["SearchTerm"]" id="searchInput" />

                </div>
            <div class="col-md-4">
                    <label name="CategoryId" class="form-label">Category</label>
                    <select name="CategoryId" asp-items="options" class="form-select" onchange="this.form.submit()">
                    <option selected value="">All Categories</option>
                    </select>
            </div>
            <div class="col-md-4">
                    <label name="Brands" class="form-label">Brand</label>
                    <select name="Brands" asp-items="options2" class="form-select" onchange="this.form.submit()">
                    <option selected value="">All Brands</option>
                </select>
            </div>
       
            <div class="col-md-12">
                    @* <input type="submit" value="Search" class="btn btn-primary-custom w-100" /> *@

                </div>

        </div>
          </form>
    </div>
</section>

<!-- Vehicles Section -->
<section class="vehicles-section">
    <div class="container">
        <div class="section-header">
            <span class="results-count">Showing @Model.Items.Count of @Model.TotalCount vehicles</span>
            @if (User.IsInRole("Owner"))
            {

                <a asp-action="Create" class="btn btn-primary-custom">Create New</a>
            }
        </div>

        <div class="row">
           
            @foreach(var item in Model.Items)
            {
                <partial name="_CarList" model="item" />
            }

        </div>

        <!-- Pagination -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">

                <li class="page-item @(Model.PageNumber == 1 ? "disabled" : "")">
                    <a class="page-link"
                       asp-action="Index"
                       asp-route-pageNumber="@(Model.PageNumber - 1)"
                       asp-route-searchTerm="@ViewData["SearchTerm"]"
                       asp-route-Brands="@ViewData["SelectedBrand"]"
                       asp-route-CategoryId="@ViewData["SelectedCategory"]">
                        Previous
                    </a>
                </li>

                @for (int i = 1; i <= Model.TotalPages; i++)
                {
                    <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                        <a class="page-link"
                           asp-action="Index"
                           asp-route-pageNumber="@i"
                           asp-route-searchTerm="@ViewData["SearchTerm"]"
                           asp-route-Brands="@ViewData["SelectedBrand"]"
                           asp-route-CategoryId="@ViewData["SelectedCategory"]">
                            @i
                        </a>
                    </li>
                }

                <li class="page-item @(Model.PageNumber == Model.TotalPages ? "disabled" : "")">
                    <a class="page-link"
                       asp-action="Index"
                       asp-route-pageNumber="@(Model.PageNumber + 1)"
                       asp-route-searchTerm="@ViewData["SearchTerm"]"
                       asp-route-Brands="@ViewData["SelectedBrand"]"
                       asp-route-CategoryId="@ViewData["SelectedCategory"]">
                        Next
                    </a>
                </li>

            </ul>
        </nav>
    </div>
</section>


@* 
<form asp-action="Index" method="get">
    <p>
        <div class=" w-25">

        Search by min price : <input type="Range" class="form-range" min="100" max="3000" name="minPrice" id="priceRange" value="@ViewData["MinPrice"]" step="100" />
        <output for="priceRange" id="rangeValue" aria-hidden="true"></output>
        </div>

        
        <input type="submit" value="Search" class="btn btn-primary" />
    </p>
</form> *@


@* <script>
    //  function submitForm() {

    //     document.getElementById("searchForm").submit();
    // }
    // This is an example script, please modify as needed
    const rangeInput = document.getElementById('priceRange');
    const rangeOutput = document.getElementById('rangeValue');

    // Set initial value
    rangeOutput.textContent = rangeInput.value;

    rangeInput.addEventListener('input', function() {
      rangeOutput.textContent = this.value;
    });
</script> *@

<script>
    let debounceTimer;

    const searchInput = document.getElementById("searchInput");
    const form = document.getElementById("filterForm");

    searchInput.addEventListener("input", function () {
        clearTimeout(debounceTimer);

        debounceTimer = setTimeout(() => {
            form.submit();
        }, 500);
    });
</script>

